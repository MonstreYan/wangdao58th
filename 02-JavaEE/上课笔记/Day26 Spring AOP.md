# Day26 Spring AOP

## 概念

AOP：Aspect Oriented Programing.面向切面编程。你可以理解为将一个运行中的方法看做时一个空间上的一个切面。在方法的执行前后做一些事情、增强，叫做面向切面编程。面向切面编程的侧重点侧重的就是一个运行中的方法。

![image-20240513155918160](assets/image-20240513155918160.png)

## 为什么要学习AOP

其实通过前面的介绍，面向切面编程其实就类似于动态代理设计模式。为什么还需要去学习AOP呢？动态代理不好吗？

动态代理的出现，其实已经极大地简化了开发工作，但是在处理一些具体的事项上面，依然不是特别的完美。可以进一步的优化。哪些地方可以进一步优化？？？？？

需要增强的委托类的方法和需要增强的逻辑的关联上面不是特别的方便。

比如目前的method1需要具有增强1，method2需要具有增强2；但是后续随着开发工作的进行，那么这些增强的逻辑可能会有调整。假如目前生产环境遇到一个问题，那么我们需要新增一个日志打印功能，统计时间功能增强，但是这个增强逻辑只是暂时性地需要，后续一旦问题确认，那么该增强便不再需要了；或者说刚开始排查的时候，那么我们设定的范围应当是全业务代码，但是随着排查工作的进行，那么可能只需要去关联特定的业务逻辑即可。

针对前面的案例，我们的增强逻辑实际上是写在代理工具类中的，如果一个项目中，需要多个增强的逻辑，那么必须得在代理工具类中进行分发。随着业务逻辑的变更，分发的逻辑也是时钟需要变更的。下面这段代码，不同的增强分发逻辑是紧密的关联耦合在一起的，需要使用分发逻辑来进行分发。后续只要业务变更，那么我就需要再次进行修改。

```java
    public static Object getProxy(Object target){
        Class<?> targetClass = target.getClass();
        return Proxy.newProxyInstance(targetClass.getClassLoader(), targetClass.getInterfaces(), new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

                //代理类对象的方法调用时，都会调用invocationHandler.invoke方法
                //所以我们需要做的事情便是进一步去调用委托类的方法
                String methodName = method.getName();
                if(methodName.equals("xxx")){
                    enhancer1();
                }else if(methodName.equals("yyy")){
                    enhancer2();
                }
            }
        });
    }

```

希望能够有一种非常理想、非常简单的方式：业务方法和增强逻辑是彼此单独存在的；如果希望业务方法1和增强1产生关联，那么直接在某处进行一个配置即可；如果今后不希望二者再关联一起，那么接触关联即可。

![image-20240513161345966](assets/image-20240513161345966.png)

最终，我们希望业务和增强的关联方式可以实现上述的效果。他们如果需要关联在一起，进行配置即可；如果不需要关联在一起，直接接触关联即可。

**总结：AOP究竟要干什么？？？？？？AOP其实做的事情和动态代理做的事情是差不多的，只不过在动态代理的方案下，关于增强的分发逻辑有一些不太友好，如果后续业务逻辑变更，那么分发逻辑也需要同步去修改；改动还是比较大的**。



## AOP中的专业术语

Aspect：切面。切面是一个封装体。是切入点 + 通知组合在一起的封装形式，叫做切面。

切入点Pointcut：需要从哪个地方切入进来。关联哪个业务方法。使用某种技术来匹配某个连接点的过程。

通知Advice：就是增强。你需要做的何种增强，比如事务、日志、时间打印等等。

连接点Join Point：就是指的是一个一个的业务方法。

target object：委托类对象。

AOP Proxy：代理类对象。

织入Weaving：是一个过程，将连接点也通知关联在一起的过程称之为织入。

关于通知，在spring中有如下的通知形式：

前置通知：业务方法执行之前触发的增强逻辑

后置通知：业务方法执行之后触发的增强逻辑

环绕通知：业务方法的执行前后都会触发的增强逻辑

异常通知：业务方法执行产生异常时会触发得到逻辑

结果通知：业务方法正常执行完毕，返回的结果



## 入门案例

入门案例，我们将会介绍一种半自动的方式给大家入门。

使用半自动的AOP方式，需要向容器中去注册一个ProxyFactoryBean对象。









